# API統合テスト手順

## 🚀 テスト環境の準備

### 1. 開発サーバーの起動
```bash
npm run dev
```

### 2. ブラウザでアクセス
http://localhost:3000

## 🧪 テスト項目

### A. 認証テスト

#### A1. 未認証状態での履歴ページアクセス
1. ブラウザで http://localhost:3000/history にアクセス
2. **期待結果**: ログインが必要です画面が表示される
3. **確認項目**:
   - 🔒アイコンが表示される
   - "ログインが必要です"メッセージが表示される
   - ログイン・新規登録ボタンが表示される

#### A2. ユーザー登録・ログイン
1. 新規登録またはログインを実行
2. **期待結果**: 認証が成功し、履歴ページにアクセス可能

### B. フォルダー機能テスト

#### B1. フォルダー一覧表示
1. 履歴ページの「お気に入り論文」タブをクリック
2. **期待結果**: 
   - 「すべて」フォルダーが表示される
   - 既存のフォルダーがあれば表示される
   - 各フォルダーに論文数が表示される

#### B2. フォルダー作成
1. 「+ フォルダー作成」ボタンをクリック
2. フォルダー名を入力（例: "テストフォルダー"）
3. 「作成」ボタンをクリック
4. **期待結果**:
   - 新しいフォルダーが一覧に追加される
   - フォルダー作成フォームが閉じる
   - スクリーンリーダー使用時はアナウンスされる

#### B3. フォルダー削除
1. 作成したフォルダーの「×」ボタンをクリック
2. **期待結果**:
   - フォルダーが一覧から削除される
   - フォルダー内の論文は「すべて」に移動される
   - スクリーンリーダー使用時はアナウンスされる

### C. お気に入り論文機能テスト

#### C1. 論文一覧表示
1. 各フォルダーをクリックして選択
2. **期待結果**:
   - 選択したフォルダーの論文のみ表示される
   - 論文情報（タイトル、著者、雑誌、年、DOI）が表示される

#### C2. 論文のフォルダー移動
1. 論文のフォルダー選択ドロップダウンを変更
2. **期待結果**:
   - 論文が指定したフォルダーに移動される
   - フォルダーの論文数が更新される
   - スクリーンリーダー使用時はアナウンスされる

#### C3. 論文削除
1. 論文の🗑️ボタンをクリック
2. **期待結果**:
   - 論文が一覧から削除される
   - フォルダーの論文数が更新される
   - スクリーンリーダー使用時はアナウンスされる

### D. 検索履歴機能テスト

#### D1. 検索履歴表示
1. 「検索履歴」タブをクリック
2. **期待結果**: 
   - モックの検索履歴が表示される
   - 質問、カテゴリ、日時、ステータスが表示される

#### D2. お気に入りフィルター
1. 「すべて表示」/「お気に入りのみ」ボタンをクリック
2. **期待結果**:
   - フィルターに応じて表示が切り替わる
   - ボタンの表示が変更される

#### D3. お気に入り切り替え
1. 検索項目の★/☆ボタンをクリック
2. **期待結果**:
   - お気に入り状態が切り替わる
   - アイコンが★/☆で変更される

### E. アクセシビリティテスト

#### E1. キーボードナビゲーション
1. Tabキーでフォーカス移動
2. 矢印キーでタブ切り替え
3. EnterキーやSpaceキーで操作実行
4. **期待結果**: すべての機能がキーボードで操作可能

#### E2. スクリーンリーダー対応
1. スクリーンリーダーを有効にして操作
2. **期待結果**: 
   - 適切なアナウンスが行われる
   - ARIA属性が正しく設定されている

### F. エラーハンドリングテスト

#### F1. ネットワークエラー
1. ネットワークを無効にして操作実行
2. **期待結果**: エラーメッセージが表示される

#### F2. 無効なデータ
1. 空のフォルダー名で作成を試行
2. **期待結果**: 適切なバリデーションが行われる

## 🔧 デバッグ情報

### ブラウザ開発者ツール
- **Console**: エラーログの確認
- **Network**: APIリクエスト/レスポンスの確認
- **Application**: Supabase認証状態の確認

### APIエンドポイント直接テスト
```bash
# フォルダー一覧取得（認証が必要）
curl -X GET "http://localhost:3000/api/folders?userId=USER_ID"

# お気に入り論文一覧取得（認証が必要）
curl -X GET "http://localhost:3000/api/favorite-papers?userId=USER_ID"
```

## ✅ テスト完了チェックリスト

- [ ] 認証状態の確認
- [ ] フォルダー作成・削除
- [ ] 論文のフォルダー移動
- [ ] 論文削除
- [ ] 検索履歴表示
- [ ] お気に入りフィルター
- [ ] キーボードナビゲーション
- [ ] エラーハンドリング
- [ ] レスポンシブデザイン
- [ ] アクセシビリティ

## 🐛 既知の問題

1. **検索履歴API未実装**: 現在はモックデータを使用
2. **リアルタイム更新**: ページリロードが必要な場合がある
3. **エラー詳細**: 一部のエラーメッセージが汎用的

## 📝 テスト結果記録

テスト実行日: ___________
テスト実行者: ___________

| テスト項目 | 結果 | 備考 |
|-----------|------|------|
| A1. 未認証アクセス | ⭕/❌ |  |
| A2. 認証 | ⭕/❌ |  |
| B1. フォルダー表示 | ⭕/❌ |  |
| B2. フォルダー作成 | ⭕/❌ |  |
| B3. フォルダー削除 | ⭕/❌ |  |
| C1. 論文表示 | ⭕/❌ |  |
| C2. 論文移動 | ⭕/❌ |  |
| C3. 論文削除 | ⭕/❌ |  |
| D1. 検索履歴表示 | ⭕/❌ |  |
| D2. お気に入りフィルター | ⭕/❌ |  |
| D3. お気に入り切り替え | ⭕/❌ |  |
| E1. キーボードナビゲーション | ⭕/❌ |  |
| E2. スクリーンリーダー | ⭕/❌ |  |
| F1. エラーハンドリング | ⭕/❌ |  |